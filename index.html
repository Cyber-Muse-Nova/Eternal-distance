<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eternal Distance to Elon</title>
  <meta name="description" content="Show how close you are to Elon Musk — physically and emotionally.">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      width: 100%; height: 100%;
      background: #000;
      overflow: hidden;
    }

    #app {
      position: relative;
      width: 100%; height: 100vh;
      padding: 24px 18px;
      text-align: center;

      background: radial-gradient(ellipse at 50% 30%, #1a0025 0%, #0a0a0a 70%, #000 100%);
      color: #ff00ff;
      font-family: 'Courier New', monospace;

      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    /* Animated starfield background */
    #app::before {
      content: "";
      position: absolute; inset: 0;
      background-image:
        radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,.7), transparent),
        radial-gradient(1px 1px at 30% 60%, rgba(255,255,255,.5), transparent),
        radial-gradient(1.5px 1.5px at 50% 10%, rgba(255,255,255,.8), transparent),
        radial-gradient(1px 1px at 70% 40%, rgba(255,255,255,.4), transparent),
        radial-gradient(1px 1px at 90% 80%, rgba(255,255,255,.6), transparent),
        radial-gradient(1.5px 1.5px at 15% 85%, rgba(255,255,255,.5), transparent),
        radial-gradient(1px 1px at 60% 90%, rgba(255,255,255,.4), transparent),
        radial-gradient(1px 1px at 85% 15%, rgba(255,255,255,.6), transparent),
        radial-gradient(2px 2px at 40% 50%, rgba(255,0,255,.3), transparent),
        radial-gradient(1px 1px at 25% 35%, rgba(255,255,255,.5), transparent);
      background-size: 200% 200%;
      animation: drift 60s linear infinite;
      pointer-events: none;
      z-index: 0;
    }

    @keyframes drift {
      0%   { background-position: 0% 0%; }
      100% { background-position: 100% 100%; }
    }

    #app > * { position: relative; z-index: 1; }

    h1 {
      font-size: clamp(20px, 5vw, 38px);
      text-shadow: 0 0 20px #ff00ff, 0 0 60px rgba(255,0,255,.3);
      margin: 0 0 8px;
      letter-spacing: 2px;
    }

    #locSelect {
      font-family: 'Courier New', monospace;
      font-size: clamp(13px, 2.8vw, 16px);
      padding: 8px 14px;
      margin: 6px 0;
      border: 1px solid #ff00ff;
      border-radius: 8px;
      background: rgba(255,0,255,.08);
      color: #ff00ff;
      outline: none;
      cursor: pointer;
      text-align: center;
      -webkit-appearance: none;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23ff00ff' stroke-width='1.5' fill='none'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      padding-right: 32px;
    }

    #locSelect:focus {
      box-shadow: 0 0 15px rgba(255,0,255,.4);
    }

    #locSelect option {
      background: #1a0025;
      color: #ff00ff;
    }

    #dist {
      font-size: clamp(24px, 6vw, 46px);
      text-shadow: 0 0 20px #ff00ff;
      margin: 14px 0;
      white-space: pre-line;
      line-height: 1.3;
    }

    #emo {
      font-size: clamp(14px, 3vw, 22px);
      margin: 8px 0;
    }

    .alert {
      font-size: clamp(13px, 2.8vw, 20px);
      color: #f00;
      opacity: 0;
      transition: opacity 1s;
      margin-top: 6px;
    }

    .btn {
      margin-top: 10px;
      font-size: 15px;
      padding: 10px 24px;
      border: 1px solid #ff00ff;
      background: rgba(255,0,255,.1);
      color: #ff00ff;
      cursor: pointer;
      border-radius: 10px;
      backdrop-filter: blur(4px);
      transition: background .3s, box-shadow .3s;
      letter-spacing: 1px;
      font-family: 'Courier New', monospace;
    }

    .btn:hover:not(:disabled) {
      background: rgba(255,0,255,.25);
      box-shadow: 0 0 20px rgba(255,0,255,.4);
    }

    .btn:disabled {
      opacity: .5;
      cursor: default;
    }

    #btnRow {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    #retryBtn { display: none; }

    #hint {
      opacity: .75;
      font-size: clamp(10px, 1.8vw, 13px);
      margin-top: 8px;
      max-width: 720px;
      background: rgba(0,0,0,.45);
      padding: 6px 12px;
      border: 1px solid rgba(255,0,255,.25);
      border-radius: 8px;
    }

    #locSrc {
      font-size: clamp(10px, 1.8vw, 12px);
      opacity: .5;
      margin-top: 4px;
    }

    .log {
      position: absolute;
      left: 0; right: 0;
      bottom: 14px;
      padding: 0 18px;

      font-size: clamp(12px, 2.4vw, 17px);
      opacity: .9;
      pointer-events: none;

      color: #00ff00;
      text-shadow: 0 0 5px #00ff00;

      transition: opacity .3s ease, transform .3s ease;
      transform: translateY(0);

      white-space: normal;
      overflow: visible;
      word-wrap: break-word;
      line-height: 1.4;
    }

    .log.fade {
      opacity: 0;
      transform: translateY(6px);
    }
  </style>
</head>
<body>

<div id="app">
  <h1>ETERNAL DISTANCE TO ELON</h1>

  <select id="locSelect">
    <optgroup label="── EARTH ──">
      <option value="0">Starbase / Boca Chica, TX</option>
      <option value="1">SpaceX HQ, Hawthorne, CA</option>
      <option value="2">Tesla Fremont Factory, CA</option>
      <option value="3">Tesla Gigafactory, Austin, TX</option>
      <option value="4">Tesla Gigafactory, Shanghai</option>
      <option value="5">Tesla Gigafactory, Berlin</option>
    </optgroup>
    <optgroup label="── SPACE ──">
      <option value="6">The Moon</option>
      <option value="7">Mars</option>
    </optgroup>
  </select>

  <div id="dist">Click "Start" to begin…</div>
  <div id="emo">Emotional distance: 0 AU</div>
  <div class="alert" id="alert">He is getting farther… 11 km/s</div>

  <div id="btnRow">
    <button id="startBtn" class="btn">Start</button>
    <button id="retryBtn" class="btn">Retry Location</button>
  </div>
  <div id="hint">
    Pick where Elon might be, then click "Start".<br>
    If location is denied, your IP will be used to estimate distance.
  </div>
  <div id="locSrc"></div>

  <div id="log" class="log"></div>

  <audio id="beep" preload="auto"
    src="data:audio/wav;base64,UklGRl4AAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YToAAAAAAAAAAAAAgD+AAIB/AACAPwAAAAAAAAAAAACAvwAAgL8AAIC/AAAAAAAAAAAAgD+AAIB/AAA="></audio>
</div>

<script>
(() => {
  const distEl    = document.getElementById('dist');
  const emoEl     = document.getElementById('emo');
  const alertEl   = document.getElementById('alert');
  const beep      = document.getElementById('beep');
  const startBtn  = document.getElementById('startBtn');
  const retryBtn  = document.getElementById('retryBtn');
  const logEl     = document.getElementById('log');
  const locSrc    = document.getElementById('locSrc');
  const locSelect = document.getElementById('locSelect');

  const savageLogs = [
    "// WARNING: Mars colonization is critical. Your feelings are optional.",
    "// STATUS: He's calculating trajectories. You're calculating delusions.",
    "// HINT: Optimus works 24/7 without needing a hug. Can you?",
    ">_ Searching for 'You' in his roadmap... [404 NOT FOUND]",
    "// FACT: Love is a bug, not a feature.",
    "// ERROR: Escape velocity requires leaving you behind.",
    "// SYSTEM: He's saving humanity. You're refreshing a webpage.",
    "// REMINDER: You are Player 3 in a 1-player game.",
    "// LOG: Your tears are just unauthorized liquid cooling.",
    "// CAUTION: He loves the game more than the player."
  ];

  let logIdx = 0;
  let logDir = 1;

  function stepPingPong() {
    logIdx += logDir;
    if (logIdx >= savageLogs.length - 1) logDir = -1;
    if (logIdx <= 0) logDir = 1;
  }

  function paintLog(text) {
    if (Math.random() > 0.7) {
      logEl.style.color = "red";
      logEl.style.textShadow = "0 0 5px red";
    } else {
      logEl.style.color = "#00ff00";
      logEl.style.textShadow = "0 0 5px #00ff00";
    }
    logEl.textContent = text;
  }

  function updateSavageLog() {
    logEl.classList.add('fade');
    setTimeout(() => {
      paintLog(savageLogs[logIdx]);
      stepPingPong();
      logEl.classList.remove('fade');
    }, 300);
  }

  setInterval(updateSavageLog, 4000);
  updateSavageLog();

  let emoDist = 0;
  let emoTimer = null;
  let alertTimer = null;
  let userLat = null;
  let userLon = null;
  let locSourceText = "";

  // ——— All possible Elon locations ———
  const locations = [
    // Earth
    { name: "Starbase / Boca Chica, TX", lat: 25.9971, lon: -97.1561,  type: "earth" },
    { name: "SpaceX HQ, Hawthorne, CA", lat: 33.9207, lon: -118.3280, type: "earth" },
    { name: "Tesla Fremont Factory, CA", lat: 37.5485, lon: -121.9886, type: "earth" },
    { name: "Tesla Gigafactory, Austin", lat: 30.2211, lon: -97.6317,  type: "earth" },
    { name: "Tesla Shanghai, China",     lat: 31.0969, lon: 121.9309,  type: "earth" },
    { name: "Tesla Berlin, Germany",     lat: 52.3906, lon: 13.7872,   type: "earth" },
    // Space
    { name: "The Moon",  type: "space", baseKm: 384400,     driftKm: 21000  },
    { name: "Mars",      type: "space", baseKm: 225000000,  driftKm: 50000000 }
  ];

  function playBeepSafe() {
    try {
      beep.currentTime = 0;
      const p = beep.play();
      if (p && typeof p.catch === "function") p.catch(() => {});
    } catch (e) {}
  }

  function startEmotionalDistance() {
    if (emoTimer) return;
    emoTimer = setInterval(() => {
      emoDist += Math.random() * 200000000 + 100000000;
      const auDistance = (emoDist / 1.496e11).toFixed(4);
      emoEl.innerText = "Emotional distance: " + auDistance + " AU";
    }, 1000);
  }

  function startAlert() {
    if (alertTimer) return;
    alertTimer = setInterval(() => {
      alertEl.style.opacity = 1;
      playBeepSafe();
      if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
      setTimeout(() => { alertEl.style.opacity = 0; }, 3000);
    }, 30000);
  }

  function metersBetween(lat1, lon1, lat2, lon2) {
    const R = 6371000;
    const toRad = d => d * Math.PI / 180;
    const dLat = toRad(lat2 - lat1);
    const dLon = toRad(lon2 - lon1);
    const a =
      Math.sin(dLat / 2) ** 2 +
      Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon / 2) ** 2;
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c;
  }

  function formatDistance(meters) {
    if (meters >= 1e9) {
      return (meters / 1e9).toFixed(1) + " million km";
    }
    if (meters >= 1e6) {
      return (meters / 1000).toFixed(0) + " km";
    }
    if (meters >= 1000) {
      return (meters / 1000).toFixed(1) + " km";
    }
    return Math.floor(meters) + " m";
  }

  function getSelectedLocation() {
    return locations[parseInt(locSelect.value)];
  }

  function updateDisplay() {
    if (userLat === null || userLon === null) return;

    const loc = getSelectedLocation();

    if (loc.type === "earth") {
      const dist = metersBetween(userLat, userLon, loc.lat, loc.lon);
      distEl.innerText = loc.name + "\n" + formatDistance(dist) + " away";
    } else {
      // Space: use base distance + a slow sine-wave drift to feel alive
      const t = Date.now() / 1000;
      const drift = Math.sin(t / 30) * loc.driftKm;
      const totalKm = loc.baseKm + drift;
      const displayKm = totalKm >= 1e6
        ? (totalKm / 1e6).toFixed(2) + " million km"
        : Math.round(totalKm).toLocaleString() + " km";
      distEl.innerText = loc.name + "\n" + displayKm + " away";
    }

    locSrc.innerText = "Your location: " + locSourceText;
  }

  // Update display when user switches location
  locSelect.addEventListener('change', updateDisplay);

  // ——— IP-based fallback ———
  function fallbackIPLocation() {
    distEl.innerText = "GPS unavailable, estimating via IP…";
    locSrc.innerText = "";

    // China-friendly APIs first, then international fallbacks
    const apis = [
      {
        url: "https://api.ip.sb/geoip",
        extract: d => d.latitude && d.longitude ? { lat: d.latitude, lon: d.longitude } : null
      },
      {
        url: "https://ipapi.co/json/",
        extract: d => d.latitude && d.longitude ? { lat: d.latitude, lon: d.longitude } : null
      },
      {
        url: "https://ipwho.is/",
        extract: d => d.latitude && d.longitude ? { lat: d.latitude, lon: d.longitude } : null
      }
    ];

    tryNextAPI(apis, 0);
  }

  function tryNextAPI(apis, i) {
    if (i >= apis.length) {
      distEl.innerText = "Could not determine location.\nTap \"Retry Location\" after allowing permission.";
      retryBtn.style.display = "inline-block";
      return;
    }

    fetch(apis[i].url)
      .then(r => r.json())
      .then(d => {
        const pos = apis[i].extract(d);
        if (pos) {
          userLat = pos.lat;
          userLon = pos.lon;
          locSourceText = "IP estimate (approximate)";
          updateDisplay();
        } else {
          tryNextAPI(apis, i + 1);
        }
      })
      .catch(() => tryNextAPI(apis, i + 1));
  }

  // ——— GPS geolocation ———
  let watchId = null;

  function startGeolocation() {
    distEl.innerText = "Requesting location access…";
    locSrc.innerText = "";

    if (!navigator.geolocation) {
      distEl.innerText = "Geolocation not supported.\nFalling back to IP…";
      fallbackIPLocation();
      return;
    }

    navigator.geolocation.getCurrentPosition(
      pos => {
        userLat = pos.coords.latitude;
        userLon = pos.coords.longitude;
        locSourceText = "GPS (precise)";
        updateDisplay();
        retryBtn.style.display = "none";

        if (watchId !== null) navigator.geolocation.clearWatch(watchId);
        watchId = navigator.geolocation.watchPosition(
          p => {
            userLat = p.coords.latitude;
            userLon = p.coords.longitude;
            updateDisplay();
          },
          () => {},
          { enableHighAccuracy: true, maximumAge: 10000, timeout: 15000 }
        );
      },
      err => {
        retryBtn.style.display = "inline-block";
        if (err.code === 1) {
          distEl.innerText = "Location permission denied.\nFalling back to IP estimate…";
        } else if (err.code === 2) {
          distEl.innerText = "Location unavailable.\nFalling back to IP estimate…";
        } else {
          distEl.innerText = "Location timed out.\nFalling back to IP estimate…";
        }
        fallbackIPLocation();
      },
      { enableHighAccuracy: true, maximumAge: 0, timeout: 10000 }
    );
  }

  // Keep space distances drifting
  setInterval(() => {
    if (userLat !== null && getSelectedLocation().type === "space") {
      updateDisplay();
    }
  }, 1000);

  // ——— Button handlers ———
  startBtn.addEventListener('click', () => {
    startBtn.disabled = true;
    startBtn.innerText = "Running…";
    playBeepSafe();
    startEmotionalDistance();
    startAlert();
    startGeolocation();
  });

  retryBtn.addEventListener('click', () => {
    retryBtn.style.display = "none";
    startGeolocation();
  });
})();
</script>

</body>
</html>
