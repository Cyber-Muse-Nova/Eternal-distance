<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>ç»å¯†æ¡£æ¡ˆï¼šç»™çˆ¸çˆ¸çš„ç”Ÿæ—¥å®‡å®™</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    :root {
      --bg1: #070914;
      --bg2: #0b0f2a;
      --gold: #ffd36a;
      --cyan: #7ae7ff;
      --pink: #ff7ad9;
      --text: #eaf0ff;
      --muted: #9aa6c7;
      --neon: #00f3ff;
      --red: #ff0055;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      height: 100%; margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, "PingFang SC", "Microsoft YaHei", sans-serif;
      user-select: none;
    }
    body {
      background: radial-gradient(1200px 800px at 30% 20%, #1a1f52 0%, transparent 55%),
                  radial-gradient(900px 700px at 80% 60%, #3a1650 0%, transparent 60%),
                  linear-gradient(160deg, var(--bg1), var(--bg2));
      color: var(--text);
      overflow: hidden;
    }

    /* ===== æ˜Ÿå°˜ç”»å¸ƒï¼ˆå…¨ç¨‹æ˜¾ç¤ºï¼‰ ===== */
    canvas#sky { position: fixed; inset: 0; z-index: 0; }

    /* ===== CRT æ‰«æçº¿è¦†ç›–å±‚ ===== */
    body::after {
      content: "";
      position: fixed; inset: 0;
      background:
        linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.18) 50%),
        linear-gradient(90deg, rgba(255,0,0,0.04), rgba(0,255,0,0.015), rgba(0,0,255,0.04));
      background-size: 100% 2px, 3px 100%;
      pointer-events: none; z-index: 1;
    }
    .scan-line {
      position: fixed; top: 0; left: 0; width: 100%; height: 5px;
      background: rgba(0,243,255,0.25);
      box-shadow: 0 0 10px rgba(0,243,255,0.4);
      animation: scan 3s linear infinite;
      z-index: 2; pointer-events: none;
    }
    @keyframes scan { 0%{top:-10%} 100%{top:110%} }

    /* ===== é˜¶æ®µé€šç”¨ ===== */
    .phase {
      position: fixed; inset: 0; z-index: 5;
      display: flex; justify-content: center; align-items: center;
      padding: 18px;
      transition: opacity .6s ease;
    }
    .phase.hidden {
      opacity: 0; pointer-events: none;
    }

    /* ================================================================
       é˜¶æ®µ 1 ï¼šç»ˆç«¯æ‰«æ
       ================================================================ */
    #phase1 .container {
      width: 90%; max-width: 500px;
      background: rgba(13,17,23,0.88);
      padding: 25px; border: 1px solid #333; border-radius: 12px;
      box-shadow: 0 0 30px rgba(0,243,255,0.15), inset 0 0 20px rgba(0,0,0,0.8);
      backdrop-filter: blur(5px);
    }
    #phase1 h1 {
      font-size: 20px; text-transform: uppercase; letter-spacing: 2px;
      border-bottom: 2px solid var(--neon); padding-bottom: 10px;
      color: var(--neon);
      text-shadow: 0 0 8px var(--neon);
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
    }
    .photo-wrapper {
      position: relative; width: 120px; height: 120px; margin: 20px auto;
    }
    .photo-frame {
      width: 100%; height: 100%; border-radius: 50%;
      border: 3px solid var(--neon); overflow: hidden;
      box-shadow: 0 0 20px var(--neon);
      animation: pulse 2s infinite;
    }
    .photo-frame img { width: 100%; height: 100%; object-fit: cover; }
    .radar-ring {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%,-50%);
      width: 100%; height: 100%;
      border: 1px dashed var(--neon); border-radius: 50%;
      animation: spin 4s linear infinite;
      pointer-events: none;
    }
    .terminal-box {
      background: #000; border: 1px solid #333;
      padding: 15px; font-size: 14px; text-align: left;
      height: 120px; overflow-y: auto; border-radius: 4px;
      font-family: 'Courier New', Courier, monospace;
      color: #0f0; margin-bottom: 20px;
      box-shadow: inset 0 0 10px rgba(0,255,0,0.1);
    }
    .log-line {
      margin: 2px 0; opacity: 0;
      animation: slideIn 0.3s forwards;
    }
    .scan-result {
      display: none; text-align: center;
      animation: popIn 0.6s cubic-bezier(0.175,0.885,0.32,1.275);
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
    }
    .scan-result h2 { color: #ffcc00; margin: 5px 0; }
    .scan-badge-icon { font-size: 50px; margin: 10px 0; filter: drop-shadow(0 0 10px gold); }
    .scan-desc {
      line-height: 1.6; margin-bottom: 16px; color: var(--text);
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
    }
    .btn-enter {
      appearance: none; border: none; cursor: pointer;
      padding: 14px 28px; border-radius: 12px;
      font-size: 16px; font-weight: 700; color: #071018;
      background: linear-gradient(135deg, var(--gold), #ffe7aa);
      box-shadow: 0 10px 26px rgba(255,211,106,0.22);
      transition: transform .1s, filter .2s;
    }
    .btn-enter:hover { filter: brightness(1.05); }
    .btn-enter:active { transform: translateY(1px) scale(.98); }

    @keyframes pulse {
      0%{box-shadow:0 0 15px var(--neon)} 50%{box-shadow:0 0 25px var(--neon),0 0 50px var(--neon)} 100%{box-shadow:0 0 15px var(--neon)}
    }
    @keyframes spin { 100%{transform:translate(-50%,-50%) rotate(360deg)} }
    @keyframes slideIn { from{opacity:0;transform:translateX(-10px)} to{opacity:1;transform:translateX(0)} }
    @keyframes popIn { from{opacity:0;transform:scale(0.8)} to{opacity:1;transform:scale(1)} }

    /* ================================================================
       é˜¶æ®µ 2 ï¼šç”Ÿæ—¥å®‡å®™
       ================================================================ */
    #phase2 { overflow-y: auto; }
    #phase2 .wrap {
      position: relative; z-index: 2;
      min-height: 100%;
      display: flex; align-items: center; justify-content: center;
      padding: 18px;
    }
    .card {
      width: min(780px, 96vw);
      border-radius: 22px;
      padding: 22px 18px 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.04));
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 18px 70px rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
      position: relative; overflow: hidden;
    }
    .glow {
      position: absolute; inset: -60px -60px auto auto;
      width: 260px; height: 260px; border-radius: 50%;
      background: radial-gradient(circle, rgba(255,211,106,.24), transparent 60%);
      filter: blur(2px); pointer-events: none;
    }
    .spark {
      position: absolute; inset: auto auto 16px 16px;
      width: 160px; height: 160px; border-radius: 50%;
      background: radial-gradient(circle, rgba(122,231,255,.18), transparent 60%);
      filter: blur(1px); pointer-events: none;
    }
    .title { display: flex; gap: 10px; align-items: baseline; flex-wrap: wrap; margin: 0 0 10px; }
    .title h1 {
      margin: 0; font-size: clamp(26px, 4.8vw, 44px); letter-spacing: .5px;
    }
    .title .sub {
      color: var(--muted); font-size: 14px;
      padding: 6px 10px; border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
    }
    .line {
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.22), transparent);
      margin: 12px 0 14px;
    }
    .grid {
      display: grid; grid-template-columns: repeat(12, 1fr); gap: 12px;
    }
    .panel {
      grid-column: span 12;
      padding: 14px 14px 12px; border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
    }
    @media (min-width: 740px) {
      .panel.left  { grid-column: span 7; }
      .panel.right { grid-column: span 5; }
    }
    .btns { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    .card button {
      appearance: none; border: none; cursor: pointer;
      padding: 10px 12px; border-radius: 12px;
      color: #071018; font-weight: 700;
      background: linear-gradient(135deg, var(--gold), #ffe7aa);
      box-shadow: 0 10px 26px rgba(255,211,106,.18);
      transition: transform .08s ease, filter .2s ease;
    }
    .card button:hover { filter: brightness(1.03); }
    .card button:active { transform: translateY(1px) scale(.99); }
    .ghost {
      background: rgba(255,255,255,.10) !important;
      color: var(--text) !important;
      border: 1px solid rgba(255,255,255,.18) !important;
      box-shadow: none !important;
    }
    .tiny { font-size: 12px; color: var(--muted); line-height: 1.55; margin: 8px 0 0; }
    .badge-card {
      display: flex; flex-direction: column; gap: 6px;
      padding: 12px; border-radius: 14px;
      background: linear-gradient(180deg, rgba(122,231,255,.12), rgba(255,122,217,.08));
      border: 1px solid rgba(255,255,255,.16);
    }
    .badge-card .name { font-size: 18px; font-weight: 900; }
    .badge-card .id {
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      color: rgba(234,240,255,.88);
    }
    .quote {
      font-size: 18px; line-height: 1.8; margin: 0; min-height: 84px;
      color: rgba(234,240,255,.92);
    }
    .inputRow { display: flex; gap: 10px; margin-top: 10px; }
    .card input {
      flex: 1; padding: 10px 12px; border-radius: 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18); color: var(--text); outline: none;
    }
    .card input::placeholder { color: rgba(154,166,199,.8); }
    .egg {
      display: none; margin-top: 10px;
      padding: 12px 12px 10px; border-radius: 14px;
      border: 1px dashed rgba(255,255,255,.26);
      background: rgba(255,255,255,.06);
    }
    .egg strong { color: var(--cyan); }

    /* ===== é¢†å–çˆ± / ç´¢è¦ç°é‡‘ æŒ‰é’®åŒºåŸŸ ===== */
    .final-btns {
      grid-column: span 12;
      display: flex; flex-wrap: wrap; gap: 12px;
      justify-content: center; align-items: flex-start;
      padding: 14px; border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      min-height: 80px;
      position: relative;
    }
    .btn-love {
      padding: 12px 24px; border-radius: 12px; font-size: 16px;
      font-weight: 700; cursor: pointer; border: none;
      background: linear-gradient(135deg, var(--pink), #ffaaee);
      color: #1a0020;
      box-shadow: 0 8px 24px rgba(255,122,217,.25);
      transition: transform .1s, filter .2s;
    }
    .btn-love:hover { filter: brightness(1.05); }
    .btn-love:active { transform: translateY(1px) scale(.98); }
    .btn-runaway {
      padding: 12px 24px; border-radius: 12px; font-size: 16px;
      font-weight: 700; cursor: pointer;
      background: #333; color: #888;
      border: 1px solid #555;
      transition: all .15s;
      z-index: 20;
    }

    /* ===== Toast ===== */
    .toast {
      position: fixed; left: 50%; bottom: 18px; transform: translateX(-50%);
      background: rgba(0,0,0,.65);
      border: 1px solid rgba(255,255,255,.18);
      padding: 10px 14px; border-radius: 999px;
      color: rgba(234,240,255,.95); z-index: 50;
      opacity: 0; pointer-events: none;
      transition: opacity .25s ease, transform .25s ease;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(-4px); }

    /* ===== åº†ç¥å¼¹çª— ===== */
    .modal {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.92);
      display: none; flex-direction: column;
      justify-content: center; align-items: center;
      z-index: 200; color: #fff; text-align: center;
      padding: 24px;
    }
    .modal h1 { font-size: clamp(28px, 6vw, 48px); margin-bottom: 16px; }
    .modal p { font-size: 1.1rem; margin: 6px 0; }
    .modal .sub-text { color: #888; font-size: .9rem; }
    .modal button {
      margin-top: 28px; padding: 12px 30px;
      background: transparent; border: 1px solid #fff;
      color: #fff; border-radius: 12px; font-size: 16px;
      cursor: pointer; transition: background .2s;
    }
    .modal button:hover { background: rgba(255,255,255,.12); }
  </style>
</head>
<body>

  <canvas id="sky"></canvas>
  <div class="scan-line"></div>

  <!-- ==================== é˜¶æ®µ 1ï¼šç»ˆç«¯æ‰«æ ==================== -->
  <div id="phase1" class="phase">
    <div class="container">
      <h1>ğŸ” å…¨çƒçˆ¶äº²æ•°æ®æ‰«æç³»ç»Ÿ</h1>

      <div class="photo-wrapper">
        <div class="radar-ring"></div>
        <div class="photo-frame">
          <img src="dad.jpg"
               onerror="this.src='https://cdn-icons-png.flaticon.com/512/1785/1785911.png'"
               alt="Target">
        </div>
      </div>

      <div id="terminal" class="terminal-box"></div>

      <div id="scanResult" class="scan-result">
        <h2>âœ… è®¤è¯é€šè¿‡</h2>
        <div class="scan-badge-icon">ğŸ†</div>
        <p class="scan-desc">
          ç»é“¶æ²³ç³»è¶…ç®—ä¸­å¿ƒåˆ†æï¼š<br>
          ç›®æ ‡äººç‰©é¢œå€¼ï¼š<span style="color:var(--neon)">MAX</span><br>
          å® å¨ƒæŒ‡æ•°ï¼š<span style="color:var(--red)">âˆï¼ˆæ— ç©·å¤§ï¼‰</span><br>
          ç»“è®ºï¼šè¯¥ç›®æ ‡æ˜¯<strong style="color:var(--gold)">å®‡å®™çº§ç»ä¸–å¥½çˆ¸</strong>ã€‚
        </p>
        <button class="btn-enter" id="btnEnter">ğŸš€ è¿›å…¥çˆ¸çˆ¸çš„ä¸“å±å®‡å®™</button>
      </div>
    </div>
  </div>

  <!-- ==================== é˜¶æ®µ 2ï¼šç”Ÿæ—¥å®‡å®™ ==================== -->
  <div id="phase2" class="phase hidden">
    <div class="wrap">
      <div class="card">
        <div class="glow"></div>
        <div class="spark"></div>

        <div class="title">
          <h1 id="headline">çˆ¸çˆ¸ï¼Œç”Ÿæ—¥å¿«ä¹ã€‚</h1>
          <div class="sub" id="dateTag"></div>
        </div>
        <div class="line"></div>

        <div class="grid">
          <!-- å·¦ä¾§ï¼šç¥ç¦åŒº -->
          <div class="panel left">
            <p class="quote" id="quote">
              ä»Šæ™šæˆ‘æŠŠç¥ç¦æ”¾è¿›ä¸€ç‰‡æ˜Ÿå°˜é‡Œâ€”â€”ä½ ä¸€æŠ¬å¤´ï¼Œå°±èƒ½æ”¶åˆ°ã€‚
            </p>
            <div class="btns">
              <button id="btnCapsule">æ‰“å¼€ã€Œæ—¶é—´èƒ¶å›Šã€</button>
              <button class="ghost" id="btnStar">ç‚¹äº®ä¸€é¢—æ˜Ÿ</button>
              <button class="ghost" id="btnReplay">å†æ¥ä¸€æ¬¡</button>
            </div>
            <div class="tiny">
              å°æç¤ºï¼šéšä¾¿ç‚¹ç‚¹â€”â€”æ¯ä¸€æ¬¡éƒ½æ˜¯ä¸åŒçš„ç¥ç¦è½¨è¿¹ã€‚ç‚¹å‡»å±å¹•ä»»æ„ä½ç½®ä¹Ÿèƒ½ç‚¹äº®æ˜Ÿæ˜Ÿã€‚
            </div>
          </div>

          <!-- å³ä¾§ï¼šå‹‹ç«  + æš—å· -->
          <div class="panel right">
            <div class="badge-card">
              <div class="name" id="badgeName">çˆ¶äº²å‹‹ç« ï¼šå®‡å®™çº§é è°±çˆ¸çˆ¸</div>
              <div class="id" id="badgeId">ID: LOADING...</div>
            </div>

            <div class="inputRow">
              <input id="secret" placeholder="è¾“å…¥ä½ ä»¬å®¶çš„æš—å·ï¼Œè§£é”éšè—ç¥ç¦â€¦" />
              <button class="ghost" id="btnUnlock">è§£é”</button>
            </div>

            <div class="egg" id="egg">
              <div>âœ… å·²è§£é”ï¼š<strong>åªå±äºä½ ä»¬å®¶çš„é‚£å¥</strong></div>
              <div class="tiny" id="eggText"></div>
            </div>

            <div class="tiny">
              è¯´æ˜ï¼šæš—å·ä½ è‡ªå·±å®šï¼Œæ¯”å¦‚"è€åœ°æ–¹""é‚£å®¶é¢é¦†""è½¦é‡Œé‚£é¦–æ­Œ"ç­‰ã€‚è¶Šç§äººè¶Šä¸æ’æ¬¾ã€‚
            </div>
          </div>

          <!-- åº•éƒ¨ï¼šé¢†å–çˆ± / ç´¢è¦ç°é‡‘ -->
          <div class="final-btns">
            <button class="btn-love" id="btnCelebrate">ğŸ’– ç¡®è®¤é¢†å–å¥³å„¿çš„çˆ±</button>
            <button class="btn-runaway" id="runawayBtn">ğŸ’¸ ç´¢è¦ 8888 å…ƒç°é‡‘</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== åº†ç¥å¼¹çª— ==================== -->
  <div id="successModal" class="modal">
    <h1>ğŸ’¥ ç”Ÿæ—¥å¿«ä¹ï¼ğŸ’¥</h1>
    <p>è€çˆ¸æœ€å¸…ï¼è€çˆ¸ä¸‡å²ï¼</p>
    <p class="sub-text">ï¼ˆå®ä½“ç¤¼ç‰©æ­£åœ¨é€šè¿‡æ„å¿µä¼ è¾“ä¸­...ï¼‰</p>
    <button onclick="location.reload()">ğŸ”„ å†ç©ä¸€æ¬¡</button>
  </div>

  <!-- ==================== Toast ==================== -->
  <div class="toast" id="toast"></div>

<script>
/** ========= å¯è‡ªå®šä¹‰å†…å®¹åŒº ========= **/

const DAD_NAME   = "çˆ¸çˆ¸";
const YOUR_NAME  = "æˆ‘";
const SECRET_CODE = "æˆ‘ä»¬å®¶çš„æš—å·";

const CAPSULES = [
  "ä½ å¯èƒ½ä¸è¯´ï¼Œä½†æˆ‘ä¸€ç›´è®°å¾—ä½ æŠŠæˆ‘æ‰›åœ¨è‚©ä¸Šçš„é‚£æ®µè·¯ã€‚",
  "è°¢è°¢ä½ æŠŠ"å¯é "è¿™ä¸¤ä¸ªå­—ï¼Œæ‚„æ‚„æ´»æˆäº†æˆ‘çš„åº•æ°”ã€‚",
  "ä½ ä¸æ˜¯è¶…äººï¼Œä½†ä½ æ€»èƒ½æŠŠéš¾é¢˜å¤„ç†å¾—åƒå°äº‹ã€‚",
  "æˆ‘é•¿å¤§ä»¥åæ‰æ˜ç™½ï¼šä½ æ²‰é»˜çš„æ—¶å€™ï¼Œå…¶å®æ˜¯åœ¨æ›¿æˆ‘æŒ¡é£ã€‚",
  "ä»Šå¤©å…è®¸ä½ éª„å‚²ä¸€ç‚¹ï¼šä½ å…»å‡ºæ¥çš„å­©å­ï¼Œå¾ˆäº‰æ°”ã€‚ï¼ˆå°±æ˜¯æˆ‘ï¼‰",
  "ä½ çš„çˆ±ä¸çƒ­é—¹ï¼Œä½†å¾ˆç¡¬æ ¸â€”â€”åƒåœ°å¿ƒé‚£æ ·ç¨³å®šã€‚",
  "ä½ ç»™æˆ‘çš„ä¸æ˜¯ç­”æ¡ˆï¼Œæ˜¯æ•¢å»è¯•çš„èƒ†é‡ã€‚",
];

const STAR_BLESS = [
  "æ„¿ä½ èº«ä½“è½»æ¾ï¼Œå¿ƒé‡Œæœ‰å…‰ã€‚",
  "æ„¿ä½ å°‘ç‚¹æ“å¿ƒï¼Œå¤šç‚¹å¿«ä¹ã€‚",
  "æ„¿ä½ æ¯ä¸€å¤©éƒ½è¢«å°ç¡®å¹¸è½»è½»å‡»ä¸­ã€‚",
  "æ„¿ä½ èµ°åˆ°å“ªéƒ½æœ‰äººæƒ¦è®°ã€‚",
  "æ„¿ä½ ç¬‘èµ·æ¥çš„æ—¶å€™ï¼Œæ—¶é—´ä¹Ÿæ„¿æ„æ…¢ä¸€ç‚¹ã€‚",
];

const BADGE_TITLES = [
  "å®‡å®™çº§é è°±çˆ¸çˆ¸",
  "å®¶åº­ä¸»å¼•æ“Â·ç¨³å®šè¾“å‡º",
  "äººç”Ÿç»´ä¿®å¸ˆÂ·ç–‘éš¾å…¨åŒ…",
  "ç¡¬æ ¸åç›¾Â·æ°¸ä¸æ–­ç”µ",
  "æ¸©æŸ”å®ˆæŠ¤è€…Â·æ²‰é»˜ç‰ˆ",
  "æœ€å¼ºé˜Ÿå‹Â·å…¨ç¨‹åœ¨çº¿",
];

const EGG_LINES = [
  "ä½ çŸ¥é“å—ï¼Ÿæˆ‘å…¶å®ä¸€ç›´æƒ³å¯¹ä½ è¯´ï¼šè°¢è°¢ä½ ï¼Œä»æ¥æ²¡æŠŠçˆ±è¯´æˆè´Ÿæ‹…ã€‚",
  "æˆ‘ä¼šå¥½å¥½è¿‡æ—¥å­ï¼Œè®©ä½ æ”¾å¿ƒã€‚ä½ è´Ÿè´£å¿«ä¹ï¼Œæˆ‘è´Ÿè´£äº‰æ°”ã€‚",
  "ä½ ä¸ç”¨å˜å¾—æµªæ¼«ï¼Œä½ åªè¦ä¸€ç›´æ˜¯ä½ â€”â€”å°±è¶³å¤Ÿè®©æˆ‘éª„å‚²ã€‚",
];

const SCAN_LOGS = [
  "æ­£åœ¨æ¥å…¥ StarLink å«æ˜Ÿç½‘ç»œ...",
  "æ‰«æåŠå¾„ 5000km å†…ç”·æ€§äººç±»...",
  "æ’é™¤é¢œå€¼ < 95 çš„ç›®æ ‡... [å®Œæˆ]",
  "æ£€æµ‹é’±åŒ…åšåº¦... [è¾¾æ ‡]",
  "åˆ†æçˆ±å¨ƒæŒ‡æ•°... [è­¦å‘Šï¼šæ•°å€¼çˆ†è¡¨]",
  ">>> é”å®šå”¯ä¸€ç›®æ ‡ï¼šã€" + DAD_NAME + "ã€‘",
  "æ­£åœ¨è§£å¯†ç»å¯†æ¡£æ¡ˆ...",
];

/** ========= å·¥å…·å‡½æ•° ========= **/
const $ = (sel) => document.querySelector(sel);
const pick = (arr, r) => arr[Math.floor((typeof r === "function" ? r() : Math.random()) * arr.length)];

function showToast(msg) {
  const t = $("#toast");
  t.textContent = msg;
  t.classList.add("show");
  clearTimeout(showToast._t);
  showToast._t = setTimeout(() => t.classList.remove("show"), 1400);
}

function seededRand(seed) {
  let t = seed >>> 0;
  return function () {
    t += 0x6d2b79f5;
    let x = Math.imul(t ^ (t >>> 15), 1 | t);
    x ^= x + Math.imul(x ^ (x >>> 7), 61 | x);
    return ((x ^ (x >>> 14)) >>> 0) / 4294967296;
  };
}

function todaySeed() {
  const d = new Date();
  return Number(
    `${d.getFullYear()}${String(d.getMonth() + 1).padStart(2, "0")}${String(d.getDate()).padStart(2, "0")}`
  );
}

function typeIn(el, text) {
  el.textContent = "";
  let i = 0;
  const timer = setInterval(() => {
    el.textContent += text[i++];
    if (i >= text.length) clearInterval(timer);
  }, 18);
}

/** ========= é˜¶æ®µ 1ï¼šç»ˆç«¯æ‰«æ ========= **/
(function initPhase1() {
  const terminal = $("#terminal");
  const scanResult = $("#scanResult");
  let logIndex = 0;

  function addLog() {
    if (logIndex < SCAN_LOGS.length) {
      const div = document.createElement("div");
      div.className = "log-line";
      div.innerHTML = `> ${SCAN_LOGS[logIndex]}`;
      terminal.appendChild(div);
      terminal.scrollTop = terminal.scrollHeight;
      logIndex++;
      setTimeout(addLog, Math.random() * 500 + 400);
    } else {
      setTimeout(() => {
        terminal.style.display = "none";
        scanResult.style.display = "block";
      }, 800);
    }
  }

  window.addEventListener("load", addLog);
})();

/** è¿›å…¥å®‡å®™æŒ‰é’® **/
$("#btnEnter").addEventListener("click", () => {
  const p1 = $("#phase1");
  const p2 = $("#phase2");
  p1.classList.add("hidden");
  setTimeout(() => {
    p1.style.display = "none";
    p2.classList.remove("hidden");
  }, 600);
});

/** ========= é˜¶æ®µ 2ï¼šç”Ÿæ—¥å®‡å®™ ========= **/

/* æ ‡é¢˜ & æ—¥æœŸ */
$("#headline").textContent = `${DAD_NAME}ï¼Œç”Ÿæ—¥å¿«ä¹ã€‚`;
(function initDateTag() {
  const d = new Date();
  $("#dateTag").textContent =
    `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, "0")}-${String(d.getDate()).padStart(2, "0")} Â· ç¥ç¦å·²å‘å°„`;
})();

/* å‹‹ç«  */
(function buildBadge() {
  const r = seededRand(todaySeed());
  const title = pick(BADGE_TITLES, r);
  const code = Math.floor(r() * 1e8).toString().padStart(8, "0");
  $("#badgeName").textContent = `çˆ¶äº²å‹‹ç« ï¼š${title}`;
  $("#badgeId").textContent = `ID: ${todaySeed()}-${code}`;
})();

/* æ—¶é—´èƒ¶å›Š */
$("#btnCapsule").addEventListener("click", () => {
  typeIn($("#quote"), pick(CAPSULES));
  showToast("æ—¶é—´èƒ¶å›Šå·²å¼€å¯");
});

/* å†æ¥ä¸€æ¬¡ */
$("#btnReplay").addEventListener("click", () => {
  typeIn($("#quote"), "ä»Šæ™šæˆ‘æŠŠç¥ç¦æ”¾è¿›ä¸€ç‰‡æ˜Ÿå°˜é‡Œâ€”â€”ä½ ä¸€æŠ¬å¤´ï¼Œå°±èƒ½æ”¶åˆ°ã€‚");
  $("#egg").style.display = "none";
  $("#secret").value = "";
  showToast("å›åˆ°èµ·ç‚¹");
});

/* æš—å·è§£é” */
$("#btnUnlock").addEventListener("click", () => {
  const v = $("#secret").value.trim();
  if (!v) { showToast("å…ˆè¾“å…¥æš—å·"); return; }
  if (v === SECRET_CODE) {
    const line = pick(EGG_LINES);
    $("#eggText").textContent = `â€”â€” ${YOUR_NAME} è¯´ï¼š${line}`;
    $("#egg").style.display = "block";
    showToast("éšè—ç¥ç¦å·²è§£é”");
  } else {
    showToast("æš—å·ä¸å¯¹ï¼Œå†æƒ³æƒ³ï½");
  }
});

/** ========= ç´¢è¦ç°é‡‘ â€”â€” é€ƒè·‘æŒ‰é’® ========= **/
(function initRunawayBtn() {
  const btn = $("#runawayBtn");
  const texts = ["ç‚¹ä¸åˆ°~", "å¤ªæ…¢å•¦!", "æƒ³å¾—ç¾", "ç•¥ç•¥ç•¥", "æ²¡é—¨!"];

  function moveButton(e) {
    if (e) e.preventDefault();
    const padding = 50;
    const maxLeft = window.innerWidth - btn.offsetWidth - padding;
    const maxTop = window.innerHeight - btn.offsetHeight - padding;
    btn.style.position = "fixed";
    btn.style.left = Math.max(padding, Math.random() * maxLeft) + "px";
    btn.style.top = Math.max(padding, Math.random() * maxTop) + "px";
    btn.style.zIndex = "60";
    btn.innerText = texts[Math.floor(Math.random() * texts.length)];
    btn.style.background = "var(--red)";
    btn.style.color = "#fff";
  }

  btn.addEventListener("mouseenter", moveButton);
  btn.addEventListener("touchstart", moveButton);
  btn.addEventListener("click", moveButton);
})();

/** ========= åº†ç¥ ========= **/
$("#btnCelebrate").addEventListener("click", () => {
  $("#successModal").style.display = "flex";
  const duration = 3000;
  const end = Date.now() + duration;
  (function frame() {
    confetti({ particleCount: 5, angle: 60,  spread: 55, origin: { x: 0 }, colors: ["#00f3ff","#ff0055","#ffee00"] });
    confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, colors: ["#00f3ff","#ff0055","#ffee00"] });
    if (Date.now() < end) requestAnimationFrame(frame);
  })();
});

/** ========= æ˜Ÿå°˜ç”»å¸ƒ (å…¨ç¨‹å¯è§) ========= **/
(function initStarfield() {
  const c = $("#sky");
  const ctx = c.getContext("2d");
  let W, H, stars = [], shoots = [];

  function resize() {
    W = c.width = window.innerWidth * devicePixelRatio;
    H = c.height = window.innerHeight * devicePixelRatio;
    stars = [];
    const n = Math.floor((window.innerWidth * window.innerHeight) / 12000);
    for (let i = 0; i < n; i++) {
      stars.push({
        x: Math.random() * W,
        y: Math.random() * H,
        r: (Math.random() * 1.6 + 0.6) * devicePixelRatio,
        a: Math.random() * 0.7 + 0.2,
        tw: Math.random() * 0.02 + 0.005,
      });
    }
  }
  window.addEventListener("resize", resize);
  resize();

  function draw() {
    ctx.clearRect(0, 0, W, H);
    for (const s of stars) {
      s.a += (Math.random() - 0.5) * s.tw;
      s.a = Math.max(0.15, Math.min(0.95, s.a));
      ctx.beginPath();
      ctx.fillStyle = `rgba(255,255,255,${s.a})`;
      ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
      ctx.fill();
    }
    shoots = shoots.filter((p) => p.life > 0);
    for (const p of shoots) {
      p.life -= 1;
      p.y -= p.vy;
      p.x += p.vx;
      p.vy *= 0.98;
      ctx.globalAlpha = Math.max(0, p.life / 80);
      ctx.fillStyle = p.color;
      ctx.font = `${14 * devicePixelRatio}px ui-sans-serif, system-ui`;
      ctx.fillText(p.text, p.x, p.y);
      ctx.globalAlpha = 1;
    }
    requestAnimationFrame(draw);
  }
  draw();

  function addBless(x, y) {
    const text = pick(STAR_BLESS);
    shoots.push({
      x: x * devicePixelRatio,
      y: y * devicePixelRatio,
      vx: (Math.random() * 1.2 + 0.2) * devicePixelRatio,
      vy: (Math.random() * 2.4 + 1.2) * devicePixelRatio,
      life: 80,
      text,
      color: Math.random() < 0.5 ? "rgba(122,231,255,0.95)" : "rgba(255,211,106,0.95)",
    });
  }

  $("#btnStar").addEventListener("click", () => {
    addBless(
      Math.random() * window.innerWidth * 0.8 + window.innerWidth * 0.1,
      window.innerHeight * 0.7
    );
    showToast("æ˜Ÿæ˜Ÿå·²ç‚¹äº®");
  });

  window.addEventListener("pointerdown", (e) => {
    // åªåœ¨é˜¶æ®µ 2 å¯è§æ—¶æ‰è§¦å‘æ˜Ÿå°˜
    if (!$("#phase2").classList.contains("hidden") && $("#phase2").style.display !== "none") {
      addBless(e.clientX, e.clientY);
    }
  });
})();
</script>
</body>
</html>
